<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sa√≠das - Tonel 333</title>
<style>
body{font-family:Arial;padding:20px;background:#fff8dc;color:#5c3a00;}
.topo{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;}
.logo{width:100px;}
.voltar{text-decoration:none;font-size:22px;color:#5c3a00;}
input,button{padding:6px;margin:5px 0;width:100%;}
.card{border:1px solid #5c3a00;padding:10px;margin:10px 0;border-radius:6px;background:#fff;}
</style>
</head>
<body>

<div class="topo">
<a href="index.html" class="voltar">‚Üê</a>
<img src="logo.png" class="logo">
</div>

<h2>Registrar Sa√≠da</h2>

<input type="date" id="data">
<input type="text" id="descricao" placeholder="Descri√ß√£o">
<input type="number" id="valor" placeholder="Valor">
<button onclick="salvar()">Salvar Sa√≠da</button>

<h3>Hist√≥rico de Sa√≠das</h3>
<div id="listaSaidas"></div>

<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyC1Jqc7Jjp-NcVUaxglEhmDNklndUqaF0Y",
  authDomain: "tonel-333.firebaseapp.com",
  projectId: "tonel-333",
  storageBucket: "tonel-333.firebasestorage.app",
  messagingSenderId: "1078081349485",
  appId: "1:1078081349485:web:10bcd104cc08b2bafcdc64"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

// ================= SINCRONIZA√á√ÉO =================
function salvarNaNuvem() {
  const dados = {
    clientes: JSON.parse(localStorage.getItem('clientes')) || [],
    entradas: JSON.parse(localStorage.getItem('entradas')) || [],
    fiados: JSON.parse(localStorage.getItem('fiados')) || [],
    saidas: JSON.parse(localStorage.getItem('saidas')) || []
  };
  db.collection("backup").doc("dados").set(dados);
}

function carregarDaNuvem() {
  let saidas = JSON.parse(localStorage.getItem('saidas')) || [];
  if(saidas.length) return;
  db.collection("backup").doc("dados").get().then((doc) => {
    if(doc.exists){
      const dados = doc.data();
      localStorage.setItem('saidas', JSON.stringify(dados.saidas || []));
    }
    listar();
  });
}

window.onload = carregarDaNuvem;

// ================= SA√çDAS =================
document.getElementById('data').valueAsDate = new Date();

function salvar(){
    let data = document.getElementById('data').value;
    let descricao = document.getElementById('descricao').value.trim();
    let valor = parseFloat(document.getElementById('valor').value);
    if(!descricao || isNaN(valor)) return;

    let saidas = JSON.parse(localStorage.getItem('saidas')) || [];
    saidas.push({data, descricao, valor});
    localStorage.setItem('saidas', JSON.stringify(saidas));
    salvarNaNuvem();

    document.getElementById('descricao').value = "";
    document.getElementById('valor').value = "";
    listar();
}

function listar(){
    let saidas = JSON.parse(localStorage.getItem('saidas')) || [];
    let div = document.getElementById('listaSaidas');
    div.innerHTML="";
    saidas.forEach((s,i)=>{
        div.innerHTML+=`
        <div class="card">
            ${s.data} - ${s.descricao}<br>
            R$ ${s.valor.toFixed(2)}<br>
            <button onclick="editar(${i})">‚úè Editar</button>
            <button onclick="excluir(${i})">üóë Excluir</button>
        </div>
        `;
    });
}

function editar(i){
    let saidas = JSON.parse(localStorage.getItem('saidas')) || [];
    let s = saidas[i];
    let novoDesc = prompt("Descri√ß√£o:", s.descricao);
    if(!novoDesc) return;
    let novoValor = parseFloat(prompt("Valor:", s.valor));
    if(isNaN(novoValor)) return;
    s.descricao = novoDesc;
    s.valor = novoValor;
    localStorage.setItem('saidas', JSON.stringify(saidas));
    salvarNaNuvem();
    listar();
}

function excluir(i){
    if(!confirm("Excluir sa√≠da?")) return;
    let saidas = JSON.parse(localStorage.getItem('saidas')) || [];
    saidas.splice(i,1);
    localStorage.setItem('saidas', JSON.stringify(saidas));
    salvarNaNuvem();
    listar();
}

</script>
</body>
</html>
