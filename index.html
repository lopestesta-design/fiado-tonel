<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tonel 333 - App</title>
<style>
body {font-family: Arial,sans-serif; background:#f0c808; margin:0; padding:0; display:flex; flex-direction:column; align-items:center; justify-content:flex-start; min-height:100vh; color:#5c3a00;}
.logo {margin-top:60px; margin-bottom:40px; width:220px;}
.botoes {display:grid; grid-template-columns:1fr 1fr; gap:20px; width:90%; max-width:400px;}
.botoes button {padding:15px; font-weight:bold; border:4px double #5c3a00; background:#fff8dc; color:#5c3a00; font-size:16px; cursor:pointer; border-radius:8px; transition:0.2s;}
.botoes button:hover {background:#ffe680;}
</style>
</head>
<body>

<img src="logo.png" alt="Tonel 333" class="logo">

<div class="botoes">
<button onclick="window.location.href='entradas.html'">Entradas</button>
<button onclick="window.location.href='saidas.html'">Sa칤das</button>
<button onclick="window.location.href='fiado.html'">Fiado</button>
<button onclick="window.location.href='resumo.html'">Resumo</button>
<button onclick="window.location.href='graficos.html'">Gr치ficos</button>
<button onclick="window.location.href='cadastro.html'">Cadastro</button>
<button onclick="window.location.href='caixa.html'">Caixa</button>
<button onclick="exportarBackup()">游닌 Exportar Backup</button>
<input type="file" id="importarArquivo" style="display:none" onchange="importarBackup(event)">
<button onclick="document.getElementById('importarArquivo').click()">游닋 Importar Backup</button>
</div>

<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore-compat.js"></script>

<script>
// Firebase
const firebaseConfig = {
  apiKey: "AIzaSyC1Jqc7Jjp-NcVUaxglEhmDNklndUqaF0Y",
  authDomain: "tonel-333.firebaseapp.com",
  projectId: "tonel-333",
  storageBucket: "tonel-333.firebasestorage.app",
  messagingSenderId: "1078081349485",
  appId: "1:1078081349485:web:10bcd104cc08b2bafcdc64"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

// Backup local
function exportarBackup(){
    const dados = {
        clientes: JSON.parse(localStorage.getItem('clientes'))||[],
        entradas: JSON.parse(localStorage.getItem('entradas'))||[],
        fiados: JSON.parse(localStorage.getItem('fiados'))||[],
        saidas: JSON.parse(localStorage.getItem('saidas'))||[]
    };
    let blob = new Blob([JSON.stringify(dados,null,2)], {type:"application/json"});
    let url = URL.createObjectURL(blob);
    let a = document.createElement("a");
    a.href=url; a.download="backup-tonel-333.json"; a.click();
    URL.revokeObjectURL(url);
}

function importarBackup(event){
    let arquivo=event.target.files[0]; if(!arquivo) return;
    let reader=new FileReader();
    reader.onload=function(e){
        let dados=JSON.parse(e.target.result);
        if(!confirm("Importar backup substituir치 todos os dados atuais. Continuar?")) return;
        localStorage.setItem('clientes',JSON.stringify(dados.clientes||[]));
        localStorage.setItem('entradas',JSON.stringify(dados.entradas||[]));
        localStorage.setItem('fiados',JSON.stringify(dados.fiados||[]));
        localStorage.setItem('saidas',JSON.stringify(dados.saidas||[]));
        alert("Backup importado com sucesso!"); location.reload();
    }
    reader.readAsText(arquivo);
}

// Sincroniza칞칚o com nuvem
function salvarNaNuvem(){
    const dados = {
        clientes: JSON.parse(localStorage.getItem('clientes'))||[],
        entradas: JSON.parse(localStorage.getItem('entradas'))||[],
        fiados: JSON.parse(localStorage.getItem('fiados'))||[],
        saidas: JSON.parse(localStorage.getItem('saidas'))||[]
    };
    db.collection("backup").doc("dados").set(dados);
}

function carregarDaNuvem(){
    db.collection("backup").doc("dados").get().then((doc)=>{
        if(doc.exists){
            const dados=doc.data();
            localStorage.setItem('clientes',JSON.stringify(dados.clientes||[]));
            localStorage.setItem('entradas',JSON.stringify(dados.entradas||[]));
            localStorage.setItem('fiados',JSON.stringify(dados.fiados||[]));
            localStorage.setItem('saidas',JSON.stringify(dados.saidas||[]));
        }
    });
}

// Observador autom치tico
window.addEventListener("storage", salvarNaNuvem);
carregarDaNuvem();
</script>
</body>
</html>
