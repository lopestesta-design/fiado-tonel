<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Tonel 333 - Controle de Fiado</title>

<style>
body {
  font-family: Arial, sans-serif;
  background: #111;
  color: white;
  margin: 0;
  padding: 15px;
}

h1 {
  text-align: center;
  font-size: 28px;
  margin-bottom: 20px;
}

input, select, button {
  width: 100%;
  padding: 18px;
  margin-top: 12px;
  font-size: 18px;
  border-radius: 10px;
  border: none;
}

input, select {
  background: #222;
  color: white;
}

button {
  font-weight: bold;
  cursor: pointer;
}

.btn-add { background: #28a745; color: white; }
.btn-consumo { background: #dc2626; color: white; }
.btn-pagamento { background: #16a34a; color: white; }
.btn-whats { background: #25D366; color: white; }

.cliente {
  background: #1e1e1e;
  padding: 15px;
  margin-top: 15px;
  border-radius: 10px;
  font-size: 18px;
}
</style>
</head>

<body>

<h1>Tonel 333 - Controle de Fiado</h1>

<h3>Cadastrar Cliente</h3>
<input type="text" id="nome" placeholder="Nome do Cliente">
<input type="tel" id="telefone" placeholder="Telefone 5511999999999">
<button type="button" class="btn-add" onclick="cadastrarCliente()">Cadastrar</button>

<h3>Movimentação</h3>
<select id="clienteSelect"></select>
<input type="number" id="valor" placeholder="Valor">
<button type="button" class="btn-consumo" onclick="adicionarConsumo()">Adicionar Consumo</button>
<button type="button" class="btn-pagamento" onclick="registrarPagamento()">Registrar Pagamento</button>

<h3>Clientes</h3>
<div id="lista"></div>

<script>
// === INÍCIO SCRIPT ===
let clientes = JSON.parse(localStorage.getItem("clientes")) || [];

function salvar() {
  localStorage.setItem("clientes", JSON.stringify(clientes));
  atualizarLista();
  atualizarSelect();
}

function carregar() {
  clientes = JSON.parse(localStorage.getItem("clientes")) || [];
  atualizarLista();
  atualizarSelect();
}

function cadastrarCliente() {
  let nome = document.getElementById("nome").value.trim();
  let telefone = document.getElementById("telefone").value.trim();

  if(!nome || !telefone) { alert("Preencha todos os campos"); return; }

  clientes.push({ nome, telefone, saldo: 0, historico: [] });
  document.getElementById("nome").value = "";
  document.getElementById("telefone").value = "";

  salvar();
}

function atualizarSelect() {
  let select = document.getElementById("clienteSelect");
  select.innerHTML = "";
  clientes.forEach(c => {
    let option = document.createElement("option");
    option.value = c.nome;
    option.textContent = c.nome;
    select.appendChild(option);
  });
}

function adicionarConsumo() {
  let nome = document.getElementById("clienteSelect").value;
  let valor = parseFloat(document.getElementById("valor").value);
  if(!valor) { alert("Digite um valor"); return; }

  let cliente = clientes.find(c => c.nome === nome);
  if(cliente) {
    cliente.saldo += valor;
    cliente.historico.push({ data: new Date().toLocaleDateString(), tipo: "Consumo", valor });
  }

  document.getElementById("valor").value = "";
  salvar();
}

function registrarPagamento() {
  let nome = document.getElementById("clienteSelect").value;
  let valor = parseFloat(document.getElementById("valor").value);
  if(!valor) { alert("Digite um valor"); return; }

  let cliente = clientes.find(c => c.nome === nome);
  if(cliente) {
    cliente.saldo -= valor;
    if(cliente.saldo < 0) cliente.saldo = 0;
    cliente.historico.push({ data: new Date().toLocaleDateString(), tipo: "Pagamento", valor });
  }

  document.getElementById("valor").value = "";
  salvar();
}

function enviarWhatsApp(index) {
  let cliente = clientes[index];
  let telefone = cliente.telefone.replace(/\D/g,"");
  let mensagem = "Extrato - Tonel 333\n\n";
  cliente.historico.forEach(h => {
    mensagem += `${h.data} - ${h.tipo} - R$ ${h.valor.toFixed(2)}\n`;
  });
  mensagem += `\nSaldo atual: R$ ${cliente.saldo.toFixed(2)}`;
  window.open(`https://api.whatsapp.com/send?phone=${telefone}&text=${encodeURIComponent(mensagem)}`, "_blank");
}

function atualizarLista() {
  let lista = document.getElementById("lista");
  lista.innerHTML = "";
  clientes.forEach((c,i) => {
    let historicoHTML = c.historico.map(h => `${h.data} - ${h.tipo} - R$ ${h.valor.toFixed(2)}`).join("<br>");
    lista.innerHTML += `
      <div class="cliente">
        <b>${c.nome}</b><br>
        Telefone: ${c.telefone}<br>
        <div class="saldo">Saldo: R$ ${c.saldo.toFixed(2)}</div>
        <br><b>Histórico:</b><br>
        ${historicoHTML || "Sem movimentações"}<br><br>
        <button class="btn-whats" onclick="enviarWhatsApp(${i})">Enviar WhatsApp</button>
      </div>
    `;
  });
}

carregar();
// === FIM SCRIPT ===
</script>

</body>
</html>
