<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Entradas - Tonel 333</title>

<style>
body { font-family:Arial; padding:20px; background:#fff8dc; color:#5c3a00; }
.topo { display:flex; justify-content: space-between; align-items:center; margin-bottom:20px; }
.logo { width:100px; }
.voltar { font-size:22px; text-decoration:none; color:#5c3a00; }

input, select {
    width:100%;
    padding:8px;
    margin-top:5px;
    margin-bottom:10px;
}

button {
    padding:10px;
    font-weight:bold;
    cursor:pointer;
}

.lista {
    margin-top:20px;
}

.card {
    border:1px solid #5c3a00;
    padding:10px;
    margin-bottom:10px;
    border-radius:6px;
}
</style>

</head>
<body>

<div class="topo">
<a href="index.html" class="voltar">←</a>
<img src="logo.png" class="logo">
</div>

<h2>Registrar Venda</h2>

<form id="formEntrada">

<label>Descrição:</label>
<input type="text" id="descricao" required>

<label>Valor:</label>
<input type="number" step="0.01" id="valor" required>

<label>Forma de Pagamento:</label>
<select id="pagamento">
<option value="dinheiro">Dinheiro</option>
<option value="pix">Pix</option>
<option value="debito">Débito</option>
<option value="credito">Crédito</option>
<option value="fiado">Fiado</option>
</select>

<label>Cliente (se for Fiado):</label>
<select id="cliente"></select>

<label>Data:</label>
<input type="date" id="data">

<button type="submit">Salvar</button>

</form>

<h3>Histórico de Entradas</h3>
<div class="lista" id="listaEntradas"></div>

<script>

// Define data de hoje
document.getElementById("data").value = new Date().toISOString().slice(0,10);

// Carregar clientes no select
function carregarClientes(){
    let clientes = JSON.parse(localStorage.getItem('clientes')) || [];
    let select = document.getElementById('cliente');
    select.innerHTML = "<option value=''>Selecione</option>";
    clientes.forEach(c=>{
        select.innerHTML += `<option value="${c.nome}">${c.nome}</option>`;
    });
}
carregarClientes();

// Listar histórico
function listarEntradas(){
    let entradas = JSON.parse(localStorage.getItem('entradas')) || [];
    let div = document.getElementById('listaEntradas');
    div.innerHTML = "";

    entradas.forEach(e=>{
        div.innerHTML += `
        <div class="card">
        ${e.data} - ${e.descricao} <br>
        R$ ${e.valor.toFixed(2)} - ${e.pagamento}
        ${e.pagamento==="fiado" ? " - Cliente: "+e.cliente : ""}
        </div>
        `;
    });
}
listarEntradas();


// SALVAR VENDA
document.getElementById('formEntrada').addEventListener('submit', function(e){
    e.preventDefault();

    let descricao = document.getElementById('descricao').value;
    let valor = parseFloat(document.getElementById('valor').value);
    let pagamento = document.getElementById('pagamento').value;
    let cliente = document.getElementById('cliente').value;
    let data = document.getElementById('data').value;

    // 1️⃣ Salvar entrada normal
    let entradas = JSON.parse(localStorage.getItem('entradas')) || [];
    entradas.push({descricao, valor, pagamento, cliente, data});
    localStorage.setItem('entradas', JSON.stringify(entradas));

    // 2️⃣ SE FOR FIADO -> salvar no histórico detalhado
    if(pagamento === "fiado" && cliente){

        let fiados = JSON.parse(localStorage.getItem('fiados')) || [];

        let existente = fiados.find(f => f.cliente === cliente);

        if(existente){
            existente.consumos.push({
                data: data,
                valor: valor
            });
        } else {
            fiados.push({
                cliente: cliente,
                consumos: [{
                    data: data,
                    valor: valor
                }],
                pagamentos: []
            });
        }

        localStorage.setItem('fiados', JSON.stringify(fiados));
    }

    alert("Venda registrada!");

    this.reset();
    document.getElementById("data").value = new Date().toISOString().slice(0,10);

    listarEntradas();
});

</script>

</body>
</html>
