<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Fiado - Tonel 333</title>
<script src="app.js"></script>
<style>
body { font-family: Arial,sans-serif; padding:20px; background:#fff8dc; color:#5c3a00; }
.topo { display:flex; justify-content: flex-end; align-items:center; margin-bottom:20px; }
.topo img { width:120px; }
.voltar { font-size:24px; text-decoration:none; color:#5c3a00; margin-right:auto; }
h2 { margin-top:0; }
label { display:block; margin-top:10px; }
input, select { padding:5px; margin-top:5px; width:100%; max-width:300px; }
button { margin-top:10px; padding:10px; font-weight:bold; cursor:pointer; }
.listaFiado { margin-top:20px; }
.listaFiado div { margin-bottom:10px; padding:8px; border:1px solid #5c3a00; border-radius:6px; display:flex; justify-content: space-between; align-items:center; }
.listaFiado .info { flex:1; }
.listaFiado button { padding:5px; font-size:14px; cursor:pointer; margin-left:5px; }
.pago { color: green; font-weight:bold; }
</style>
</head>
<body>

<div class="topo">
  <a href="index.html" class="voltar">←</a>
  <img src="logo.png" alt="Tonel 333">
</div>

<h2>Registrar Fiado</h2>
<form id="formFiado">
  <label>Cliente:</label>
  <select id="clienteFiado" required>
    <option value="">-- Selecione --</option>
  </select>

  <label>Valor:</label>
  <input type="number" id="valorFiado" step="0.01" required>

  <label>Pagamento:</label>
  <select id="pagamentoFiado">
    <option value="dinheiro">Dinheiro</option>
    <option value="pix">Pix</option>
    <option value="debito">Débito</option>
    <option value="credito">Crédito</option>
  </select>

  <label>Data:</label>
  <input type="date" id="dataFiado">

  <button type="submit">Registrar</button>
</form>

<h3>Registros de Fiado</h3>
<div class="listaFiado" id="listaFiado"></div>

<script>
document.getElementById('dataFiado').value = new Date().toISOString().slice(0,10);

function carregarClientesFiado(){
  let clientes = JSON.parse(localStorage.getItem('clientes')) || [];
  let select = document.getElementById('clienteFiado');
  select.innerHTML = '<option value="">-- Selecione --</option>';
  clientes.forEach(c => {
    let opt = document.createElement('option');
    opt.value = c.nome;
    opt.textContent = c.nome;
    select.appendChild(opt);
  });
}

function listarFiados(){
  let fiados = JSON.parse(localStorage.getItem('fiados')) || [];
  let div = document.getElementById('listaFiado');
  div.innerHTML = '';
  fiados.forEach((f, i)=>{
    let fDiv = document.createElement('div');
    let infoDiv = document.createElement('div');
    infoDiv.className = 'info';
    let status = f.saldo <= 0 ? `<span class="pago">Pago</span>` : `R$ ${f.saldo.toFixed(2)} restante`;
    infoDiv.innerHTML = `${f.data} - ${f.cliente} - Valor: R$ ${f.valor.toFixed(2)} - ${f.pagamento} - ${status}`;
    fDiv.appendChild(infoDiv);

    if(f.saldo > 0){
      let btnBaixar = document.createElement('button');
      btnBaixar.textContent = 'Baixar';
      btnBaixar.onclick = ()=>{
        let pago = parseFloat(prompt(`Quanto ${f.cliente} está pagando?`, f.saldo));
        if(!isNaN(pago) && pago>0){
          f.saldo -= pago;
          if(f.saldo < 0) f.saldo = 0;
          let fiadosAtual = JSON.parse(localStorage.getItem('fiados')) || [];
          fiadosAtual[i] = f;
          localStorage.setItem('fiados', JSON.stringify(fiadosAtual));
          listarFiados();
        }
      };
      fDiv.appendChild(btnBaixar);
    }

    let btnWhats = document.createElement('button');
    btnWhats.textContent = 'WhatsApp';
    btnWhats.onclick = ()=>{
      let msg = `Olá ${f.cliente}, você tem um consumo de R$ ${f.saldo.toFixed(2)} no Tonel 333. Obrigado!`;
      let url = `https://wa.me/?text=${encodeURIComponent(msg)}`;
      window.open(url,'_blank');
    };
    fDiv.appendChild(btnWhats);

    div.appendChild(fDiv);
  });
}

carregarClientesFiado();
listarFiados();

document.getElementById('formFiado').addEventListener('submit', function(e){
  e.preventDefault();
  let cliente = document.getElementById('clienteFiado').value;
  let valor = parseFloat(document.getElementById('valorFiado').value);
  let pagamento = document.getElementById('pagamentoFiado').value;
  let data = document.getElementById('dataFiado').value;

  let fiados = JSON.parse(localStorage.getItem('fiados')) || [];
  fiados.push({cliente, valor, pagamento, saldo: valor, data});
  localStorage.setItem('fiados', JSON.stringify(fiados));

  this.reset();
  document.getElementById('dataFiado').value = new Date().toISOString().slice(0,10);
  carregarClientesFiado();
  listarFiados();
});
</script>

</body>
</html>
