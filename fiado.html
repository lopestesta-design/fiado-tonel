<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Fiado</title>
<style>
body { font-family:Arial; padding:20px; background:#fff8dc; color:#5c3a00; }
.topo { display:flex; justify-content: space-between; align-items:center; margin-bottom:20px; }
.logo { width:100px; }
.voltar { font-size:22px; text-decoration:none; color:#5c3a00; }
.card { border:1px solid #5c3a00; padding:10px; margin-bottom:10px; border-radius:6px; }
button { margin-top:5px; padding:5px; }
</style>
</head>
<body>

<div class="topo">
<a href="index.html" class="voltar">←</a>
<img src="logo.png" class="logo">
</div>

<h2>Controle de Fiado</h2>

<div id="listaFiados"></div>

<script>
function listarFiados(){
    let fiados = JSON.parse(localStorage.getItem('fiados')) || [];
    let clientes = JSON.parse(localStorage.getItem('clientes')) || [];
    let div = document.getElementById('listaFiados');
    div.innerHTML = "";

    fiados.forEach((f,i)=>{
        let clienteInfo = clientes.find(c=>c.nome===f.cliente);

        div.innerHTML += `
        <div class="card">
            <strong>${f.cliente}</strong><br>
            Data: ${f.data}<br>
            Saldo: R$ ${f.saldo.toFixed(2)}<br>
            <button onclick="pagar(${i})">Dar Baixa</button>
            <button onclick="enviarWhats('${clienteInfo?.telefone || ''}','${f.cliente}',${f.saldo})">WhatsApp</button>
        </div>`;
    });
}
listarFiados();

function pagar(index){
    let fiados = JSON.parse(localStorage.getItem('fiados')) || [];
    let valor = parseFloat(prompt("Quanto ele está pagando?"));

    if(!isNaN(valor) && valor>0){
        fiados[index].saldo -= valor;
        if(fiados[index].saldo < 0) fiados[index].saldo = 0;
        localStorage.setItem('fiados', JSON.stringify(fiados));
        listarFiados();
    }
}

function enviarWhats(telefone,nome,saldo){
    let msg = `Olá ${nome}, você está devendo R$ ${saldo.toFixed(2)} no Tonel 333.`;
    window.open(`https://wa.me/${telefone}?text=${encodeURIComponent(msg)}`);
}
</script>

</body>
</html>
